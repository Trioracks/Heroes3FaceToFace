<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Лицом к лицу 1.07 База данных героев</title>
  
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- DataTables -->
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
  
  <!-- Font Awesome для иконок -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    body {
      background: linear-gradient(to bottom, #1a2a6c, #b21f1f, #1a2a6c);
      background-attachment: fixed;
      color: #f8f9fa;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
    }
    .container {
      background: rgba(30, 30, 40, 0.9);
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      padding: 30px;
      margin-top: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
      background: linear-gradient(to right, #ff9900, #ffcc00);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .dataTables_wrapper .dataTables_filter input {
      background: #2c3e50;
      color: #fff;
      border: 1px solid #3498db;
      border-radius: 4px;
    }
    .dataTables_wrapper .dataTables_length select {
      background: #2c3e50;
      color: #fff;
      border: 1px solid #3498db;
    }
    .dataTables_wrapper .dataTables_paginate .paginate_button {
      background: #2c3e50 !important;
      color: #fff !important;
      border: 1px solid #3498db !important;
      border-radius: 4px;
      margin: 0 2px;
    }
    .dataTables_wrapper .dataTables_paginate .paginate_button.current {
      background: #3498db !important;
      color: #fff !important;
    }
    .castle-icon {
      width: 28px;
      height: 28px;
      border-radius: 4px;
      vertical-align: middle;
      margin-right: 8px;
      background: #2c3e50;
      padding: 2px;
    }
    .no-data {
      background: #2c3e50;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      font-size: 1.2rem;
    }
    .filter-row {
      background: #2c3e50;
      border-radius: 8px;
      padding: 10px 15px;
      margin-bottom: 15px;
    }
    .filter-input {
      width: 100%;
      padding: 8px;
      border: 1px solid #3498db;
      border-radius: 4px;
      background: #1a2a6c;
      color: #fff;
    }
    .hero-name {
      font-weight: 600;
      color: #ffcc00;
    }
    .hero-special {
      font-style: italic;
      color: #3498db;
    }
    .table th {
      background: #1a2a6c;
      border-bottom: 2px solid #3498db;
    }
    .table td {
      vertical-align: middle !important;
    }
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      .filter-row {
        flex-direction: column !important;
      }
      .filter-input {
        margin-top: 5px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1><i class="fas fa-chess-knight"></i> База данных героев — Герои 3: Хота</h1>
    
    <div class="filter-row d-flex gap-2">
      <input type="text" class="filter-input" placeholder="Фильтр по родному замку" id="filter-castle">
      <input type="text" class="filter-input" placeholder="Фильтр по имени героя" id="filter-name">
      <input type="text" class="filter-input" placeholder="Фильтр по специализации" id="filter-special">
      <input type="text" class="filter-input" placeholder="Фильтр по заклинанию" id="filter-spell">
    </div>
    
    <table id="heroes-table" class="table table-hover">
      <thead>
        <tr>
          <th>Родной замок</th>
          <th>Иконка</th>
          <th>Название героя</th>
          <th>Специализация</th>
          <th>Заклинание</th>
          <th>Вторичные навыки</th>
          <th>Мастерство</th>
          <th>Артефакт</th>
          <th>Атака</th>
          <th>Защита</th>
          <th>Сила магии</th>
          <th>Знания</th>
        </tr>
      </thead>
      <tbody>
        <!-- Данные загрузятся здесь -->
      </tbody>
    </table>
  </div>

  <!-- jQuery и DataTables -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

  <script>
    // ВСТАВЬ СВОЮ ССЫЛКУ НА API ЗДЕСЬ ↓ (полученную через Apps Script)
    const API_URL = "https://script.google.com/macros/s/AKfycbxuqXY9GOsSwrL7qBkpUmhctyr4QNQzeKuz3XI9XZDsmePLCTJtWgH9XgrMOrtpXCxOKQ/exec";

    async function loadHeroesData() {
      try {
        const response = await fetch(API_URL);
        const data = await response.json();
        const tbody = document.querySelector("#heroes-table tbody");
        tbody.innerHTML = ""; // Очищаем таблицу

        if (data.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="12" class="text-center">
                <div class="no-data">
                  <i class="fas fa-exclamation-triangle"></i> Данные не найдены
                </div>
              </td>
            </tr>
          `;
          return;
        }

        data.forEach(hero => {
          // Формируем строку таблицы
          const row = document.createElement("tr");
          
          // Родной замок
          row.innerHTML += `<td>${hero["Родной замок"] || ""}</td>`;
          
          // Иконка замка (ссылка должна быть в столбце "Иконка")
          const castleIcon = hero["Иконка"] || "";
          const iconHtml = castleIcon ? 
            `<img src="${castleIcon}" class="castle-icon" onerror="this.style.display='none'">` : 
            `<i class="fas fa-question-circle text-muted"></i>`;
          row.innerHTML += `<td>${iconHtml}</td>`;
          
          // Название героя (с цветом)
          const heroName = hero["Название героя"] || "";
          const nameHtml = heroName ? 
            `<span class="hero-name">${heroName}</span>` : 
            "—";
          row.innerHTML += `<td>${nameHtml}</td>`;
          
          // Остальные поля
          row.innerHTML += `
            <td>${hero["Специализация"] || ""}</td>
            <td>${hero["Заклинание"] || ""}</td>
            <td>${hero["Вторичные навыки"] || ""}</td>
            <td>${hero["Мастерство"] || ""}</td>
            <td>${hero["Артефакт"] || ""}</td>
            <td>${hero["Атака"] || "0"}</td>
            <td>${hero["Защита"] || "0"}</td>
            <td>${hero["Сила магии"] || "0"}</td>
            <td>${hero["Знания"] || "0"}</td>
          `;
          
          tbody.appendChild(row);
        });

        // Инициализируем DataTables
        const table = new DataTable('#heroes-table', {
          "language": {
            "url": "//cdn.datatables.net/plug-ins/1.13.6/i18n/ru.json"
          },
          "pageLength": 25,
          "order": [[2, "asc"]],
          "initComplete": function() {
            // Добавляем фильтры по столбцам
            this.api().columns().every(function() {
              const column = this;
              const header = $(column.header());
              
              // Убираем фильтры для столбцов "Иконка" и "Название героя"
              if (header.index() === 1 || header.index() === 2) return;
              
              const input = document.createElement('input');
              input.placeholder = 'Фильтр...';
              input.className = 'filter-input';
              
              $(input).appendTo($(column.header()))
                .on('keyup change', function() {
                  if (column.search() !== this.value) {
                    column
                      .search(this.value)
                      .draw();
                  }
                });
            });
            
            // Добавляем обработку фильтров вручную (для сложных фильтров)
            $('#filter-castle').on('keyup', function() {
              table.column(0).search(this.value).draw();
            });
            $('#filter-name').on('keyup', function() {
              table.column(2).search(this.value).draw();
            });
            $('#filter-special').on('keyup', function() {
              table.column(3).search(this.value).draw();
            });
            $('#filter-spell').on('keyup', function() {
              table.column(4).search(this.value).draw();
            });
          }
        });

      } catch (error) {
        console.error("Ошибка загрузки данных:", error);
        document.querySelector("#heroes-table tbody").innerHTML = `
          <tr>
            <td colspan="12" class="text-center">
              <div class="no-data">
                <i class="fas fa-exclamation-triangle"></i> Ошибка загрузки данных
              </div>
            </td>
          </tr>
        `;
      }
    }

    // Загружаем данные при загрузке страницы
    document.addEventListener("DOMContentLoaded", loadHeroesData);
  </script>
</body>
</html>